Supplemental code for "The in vivo measurement of replication fork velocity and pausing by lag-time analysis"

Dean Huang and Paul Wiggins

Department of Physics, Bioengineering, and Microbiology

University of Washington

01/11/2023

---


## Purpose: 
- This readme file describes how to apply lag-time analysis to next-generation-sequencing (marker-frequency) data and it provides the basic functionality to allow investigators to apply this analysis to their own data sets. With that goal is mind, we have included the code to generate many of the analyses described in our manuscript.

## Directory contents:
 - `Data/`                       This directory contains the filtered and processed data for all conditions, along with all of the intermediate data structures generated during processing. The analysis pipeline requires intermediate data structures to be stored in separate files. Due to space considerations, the example FASTQ file and generated SAM file that should be in the `Ecoli/LB_Exp` directory for the `MATLAB_bowtie2.m` script to process are not included. The example FASTQ file can be downloaded from the Sequence Read Archive with accession number [ERR2403099](https://trace.ncbi.nlm.nih.gov/Traces/?run=ERR2403099). The .fastq file should then be placed in the LB_Exp directory for the script to process.
 - `Ecoli_FullAnalysis/`         This directory contains the lag-time analysis output (Figures), generated by the `Ecoli_FullAnalysis.m` script. 
 - `Ecoli_FullAnalysis.m`        This template script analyzes the E. coli dataset. This script can be modified to analyze new datasets. 
 - `Functions/`                  This directory contains all of the internal functions called by the analysis scripts. These functions should be application independent and need not be modified for the analysis of new data sets. 
 - `ReferenceGenomes/`           This directory contains the reference genome (MG1655) that was used for mapping the E. coli sequencing data. Other reference genomes used in the paper are available upon request but not included due to size.
 - `MATLAB_bowtie2.m`            This script uses MATLAB to run bowtie2 for mapping the reads and SAMtools for processing the `.sam` file to generate the marker frequencies. This will only work if the example FASTQ file has been downloaded and added to the `Data/Ecoli/LB_Exp` directory. 

## Protocol for installing the analysis package:
 - Compatability: The code has been run on Linux (Ubuntu 22.04 and 20.04), but can be made to work with Windows and macOS with appropriate installations or use of virtual machines. We expect any compatability issues that arise will be due to issues with [Bowtie 2](https://www.nature.com/articles/nmeth.1923), and [SAMtools](https://academic.oup.com/gigascience/article/10/2/giab008/6137722), which we find to run best on the Linux platform.

 - Install MATLAB with the Bioinformatics Toolbox, Bowtie 2 support, and the Optimization Toolbox.
      - We have used this script with a number of different releases (R2022a, R2022b). 
      - In MATLAB, you can check what toolboxes are installed by running the 'ver' command. Look for 'Bioinformatics Toolbox' and 'Optimization Toolbox'.
      - If the Bowtie2 package is not installed, you will get an error message asking you to install the package.

 - Install SAMtools: http://www.htslib.org/
      - Easiest way on Ubuntu: `sudo apt install samtools`

 - Add the lag-time analysis code to your MATLAB path
      - Look for the 'Set Path' putton on the MATLAB home ribbon.
      - Add the LagTimeAnalysis folder (containing this README file) and its subfolders to your MATLAB path.

## Protocol for lag-time analysis:
 ### Mapping reads and binning them using bowtie2 and SAMtools:
  - Download the example FASTQ file from the Sequence Read Archive with accession number [ERR2403099](https://trace.ncbi.nlm.nih.gov/Traces/?run=ERR2403099). Unzip the .fastq.gz file. Place the .fastq file in the `Data/Ecoli/LB_Exp` directory for the script to process.
  - Open the `MATLAB_bowtie2.m` script for an example of how to use MATLAB to map and count the reads.
  - In general, the first section shows the set of variables to change when using an arbitrary FASTQ dataset. In this case, the code already links to the example FASTQ file for demonstration purposes, so nothing needs to be changed. The example FASTQ file (`ERR2403099.fastq`) is for WT E. coli grown to exponential phase in LB at 37C. For space considerations, all other FASTQ files have been mapped and only the number of copies mapped to each base pair along the genome are included in the folders. The rest of the raw data can be downloaded from the repositories listed in the paper.
  - Running the full script generates the mapped `.sam` file and the copy number of each position, denoted `pos_3099.mat`. A histogram with 1 kb binsize is also generated to show the overall structure of the marker frequency. 
  - If the histogram does not have any structure (all counts are 0), make sure you have SAMtools installed and accessible.

 ### Filtering the data:
  - There is a dedicated section at the beginning of the `Ecoli_FullAnalysis.m` file which conducts the filtering.
  - This section applies a median filter (200 kb window size) to the data, sorts the points based on how far they are from the median filtered result, and then removes the most extreme 10%.
  - Also filters out known problematic regions (due to sequencing-related biases) and divides the exponential phase data by the stationary phase data.
  - The filtering should be done once for each set of exponential and stationary phase data. In the case of `Ecoli_FullAnalysis.m` this is done via a for loop.

 ### Running analyses and generating figures:
  - The script `Ecoli_FullAnalysis.m` is structured in the following way: There is an initial portion of the code which only needs to be activated a single time to set up the data structure, shift the data based on the location of the origin, obtain the lag time, and use model selection to determine the ideal number of legs to fit. Each section has notes describing the details. The latter portion of each script is dedicated to generation of figures and fork velocities. 
  - For best performance, uncomment each comment bracket (i.e. add `%` in front of the `%{` at the start of each chunk) one at a time and run the code for each chunk (they are all self-contained and will load in the required data each time).





